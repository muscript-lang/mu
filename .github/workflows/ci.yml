name: ci

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - name: cargo fmt
        run: cargo fmt --all -- --check
      - name: cargo clippy
        run: cargo clippy --all-targets -- -D warnings
      - name: cargo test
        run: cargo test --all-targets
      - name: muc fmt check
        run: cargo run -- fmt --check .
      - name: muc check examples
        run: cargo run -- check examples
      - name: muc run hello
        run: cargo run -- run examples/hello.mu
      - name: muc run json
        run: cargo run -- run examples/json.mu
      - name: muc build hello.mub
        run: cargo run -- build examples/hello.mu -o hello.mub
      - name: muc run hello.mub
        run: cargo run -- run hello.mub
      - name: muc build json.mub
        run: cargo run -- build examples/json.mu -o json.mub
      - name: muc run json.mub
        run: cargo run -- run json.mub
