name: fuzz

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  fuzz-smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
      - uses: dtolnay/rust-toolchain@0f1b44df7e9cbb178d781a242338dfa5e243ad7f
      - name: install cargo-fuzz
        run: cargo install cargo-fuzz --locked --version 0.13.1
      - name: fuzz lexer
        run: cargo +nightly fuzz run fuzz_lexer -- -max_total_time=30
      - name: fuzz parser
        run: cargo +nightly fuzz run fuzz_parser -- -max_total_time=30
      - name: fuzz fmt roundtrip
        run: cargo +nightly fuzz run fuzz_fmt_roundtrip -- -max_total_time=30
      - name: fuzz bytecode decode
        run: cargo +nightly fuzz run fuzz_bytecode_decode -- -max_total_time=30
      - name: fuzz vm step
        run: cargo +nightly fuzz run fuzz_vm_step -- -max_total_time=30
