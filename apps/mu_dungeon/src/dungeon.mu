@apps.mu_dungeon.dungeon{E[Room,RNil,RCons,build_rooms,main,room_count,Normal,Elite,Boss,Slime,Goblin,Skeleton,Dragon];T Monster=Slime|Goblin|Skeleton|Dragon;T RoomType=Normal|Elite|Boss;T Room=Room(i32,RoomType,Monster,i32,i32);T Rooms=RNil|RCons(Room,Rooms);T Roll=Roll(i32,i32);F abs_i32:(i32)->i32=i(c(<,arg0,0),c(neg,arg0),arg0);F next_seed:(i32)->i32=c(%,c(+,c(*,c(abs_i32,arg0),1103),97),1000003);F roll100:(i32)->Roll=v(n:i32=c(next_seed,arg0),Roll(c(%,n,100),n));F base_hp:(Monster)->i32=m(arg0){Slime=>10;Goblin=>14;Skeleton=>18;Dragon=>34;};F base_atk:(Monster)->i32=m(arg0){Slime=>3;Goblin=>4;Skeleton=>5;Dragon=>8;};F pick_normal_monster:(i32)->Monster=i(c(<,arg0,34),Slime(),i(c(<,arg0,67),Goblin(),Skeleton()));F room_type_for:(i32)->RoomType=i(c(<=,arg0,7),Normal(),i(c(<=,arg0,9),Elite(),Boss()));F room_monster_for:(i32,i32)->Monster=i(c(==,arg0,10),Dragon(),c(pick_normal_monster,arg1));F room_hp:(i32,RoomType,Monster)->i32=v(b:i32=c(base_hp,arg2),m(arg1){Normal=>c(+,b,arg0);Elite=>c(+,c(+,b,arg0),6);Boss=>c(+,b,16);});F room_atk:(i32,RoomType,Monster)->i32=v(b:i32=c(base_atk,arg2),m(arg1){Normal=>c(+,b,c(/,arg0,3));Elite=>c(+,b,2);Boss=>c(+,b,3);});F build_rooms_rec:(i32,i32)->Rooms=i(c(>,arg0,10),RNil(),v(r:Roll=c(roll100,arg1),m(r){Roll(rv,next)=>v(rt:RoomType=c(room_type_for,arg0),v(mk:Monster=c(room_monster_for,arg0,rv),RCons(Room(arg0,rt,mk,c(room_hp,arg0,rt,mk),c(room_atk,arg0,rt,mk)),c(build_rooms_rec,c(+,arg0,1),next))));}));F build_rooms:(i32)->Rooms=c(build_rooms_rec,1,arg0);F room_count:(Rooms)->i32=m(arg0){RNil=>0;RCons(_,rest)=>c(+,1,c(room_count,rest));};F main:()->i32={a(c(==,c(room_count,c(build_rooms,1)),10));0};}
