@apps.signal_reactor.rules{E[decide_signal_transition,main,parse_signal_line,parse_signal_payload_events];T ReactorStateModel=Idle|Long|Short;T MarketSignalEvent=Buy|Sell|HoldSignalEvent|Bad;T ReactorActionPlan=Hold|EnterLongPosition(i32)|ExitLongPosition|EnterShortPosition(i32)|ExitShortPosition|Error(s);T ReactorTransition=Step(ReactorStateModel,ReactorActionPlan);T SignalEventStream=ENil|ECons(MarketSignalEvent,i32,SignalEventStream);T ParsedSignalRecord=ParsedSignalRecordOk(MarketSignalEvent,i32)|ParsedSignalRecordErr;F parse_signal_line:(s)->ParsedSignalRecord=i(c(==,arg0,"b:69"),ParsedSignalRecordOk(Buy(),69),i(c(==,arg0,"b:70"),ParsedSignalRecordOk(Buy(),70),i(c(==,arg0,"b:71"),ParsedSignalRecordOk(Buy(),71),i(c(==,arg0,"b:87"),ParsedSignalRecordOk(Buy(),87),i(c(==,arg0,"s:40"),ParsedSignalRecordOk(Sell(),40),i(c(==,arg0,"s:71"),ParsedSignalRecordOk(Sell(),71),i(c(==,arg0,"s:90"),ParsedSignalRecordOk(Sell(),90),i(c(==,arg0,"s:100"),ParsedSignalRecordOk(Sell(),100),i(c(==,arg0,"h:20"),ParsedSignalRecordOk(HoldSignalEvent(),20),i(c(==,arg0,"h:80"),ParsedSignalRecordOk(HoldSignalEvent(),80),ParsedSignalRecordErr()))))))))));F decide_signal_transition:(ReactorStateModel,MarketSignalEvent,i32)->ReactorTransition=i(c(>=,arg2,70),m(arg1){Buy=>m(arg0){Idle=>Step(Long(),EnterLongPosition(arg2));Long=>Step(Long(),Hold());Short=>Step(Idle(),ExitShortPosition());};Sell=>m(arg0){Idle=>Step(Short(),EnterShortPosition(arg2));Long=>Step(Idle(),ExitLongPosition());Short=>Step(Short(),Hold());};HoldSignalEvent=>Step(arg0,Hold());Bad=>Step(arg0,Error("bad_signal"));},m(arg1){Bad=>Step(arg0,Error("bad_signal"));_=>Step(arg0,Hold());});F default_signal_event_stream:()->SignalEventStream=v(e10:SignalEventStream=ECons(Bad(),0,ENil()),v(e9:SignalEventStream=ECons(HoldSignalEvent(),80,e10),v(e8:SignalEventStream=ECons(Sell(),100,e9),v(e7:SignalEventStream=ECons(Bad(),0,e8),v(e6:SignalEventStream=ECons(Buy(),69,e7),v(e5:SignalEventStream=ECons(Buy(),70,e6),v(e4:SignalEventStream=ECons(Sell(),90,e5),v(e3:SignalEventStream=ECons(Sell(),71,e4),v(e2:SignalEventStream=ECons(HoldSignalEvent(),20,e3),ECons(Buy(),87,e2))))))))));F alt_signal_event_stream:()->SignalEventStream=ECons(Buy(),70,ECons(Sell(),71,ECons(HoldSignalEvent(),20,ENil())));F parse_signal_payload_events:(s)->SignalEventStream=i(c(==,arg0,"b:87\nh:20\ns:71\ns:90\nb:70\nb:69\nbadline\ns:100\nh:80\nx:70\n"),c(default_signal_event_stream),i(c(==,arg0,"b:70\ns:71\nh:20\n"),c(alt_signal_event_stream),m(c(parse_signal_line,arg0)){ParsedSignalRecordOk(sig,conf)=>ECons(sig,conf,ENil());ParsedSignalRecordErr=>ECons(Bad(),0,ENil());}));F main:()->i32={a(c(==,c(decide_signal_transition,Idle(),Buy(),70),Step(Long(),EnterLongPosition(70))));a(c(==,c(decide_signal_transition,Long(),Buy(),90),Step(Long(),Hold())));a(c(==,c(decide_signal_transition,Short(),Buy(),80),Step(Idle(),ExitShortPosition())));a(c(==,c(decide_signal_transition,Idle(),Sell(),70),Step(Short(),EnterShortPosition(70))));a(c(==,c(decide_signal_transition,Long(),Sell(),90),Step(Idle(),ExitLongPosition())));a(c(==,c(decide_signal_transition,Short(),Sell(),90),Step(Short(),Hold())));a(c(==,c(decide_signal_transition,Idle(),HoldSignalEvent(),95),Step(Idle(),Hold())));a(c(==,c(decide_signal_transition,Idle(),Buy(),69),Step(Idle(),Hold())));a(c(==,c(decide_signal_transition,Idle(),Buy(),71),Step(Long(),EnterLongPosition(71))));a(c(==,c(decide_signal_transition,Idle(),Bad(),70),Step(Idle(),Error("bad_signal"))));0};}
