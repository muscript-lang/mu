@apps.signal_reactor.tests.rules_test{E[main];T State=Idle|Long|Short;T Signal=Buy|Sell|HoldSig|Bad;T Action=Hold|EnterLong(i32)|ExitLong|EnterShort(i32)|ExitShort|Error(s);T Decision=Step(State,Action);F decide:(State,Signal,i32)->Decision=i(c(>=,arg2,70),m(arg1){Buy=>m(arg0){Idle=>Step(Long(),EnterLong(arg2));Long=>Step(Long(),Hold());Short=>Step(Idle(),ExitShort());};Sell=>m(arg0){Idle=>Step(Short(),EnterShort(arg2));Long=>Step(Idle(),ExitLong());Short=>Step(Short(),Hold());};HoldSig=>Step(arg0,Hold());Bad=>Step(arg0,Error("bad_signal"));},m(arg1){Bad=>Step(arg0,Error("bad_signal"));_=>Step(arg0,Hold());});F main:()->i32={a(c(==,c(decide,Idle(),Buy(),70),Step(Long(),EnterLong(70))));a(c(==,c(decide,Idle(),Sell(),70),Step(Short(),EnterShort(70))));a(c(==,c(decide,Idle(),Buy(),69),Step(Idle(),Hold())));0};}
